<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Listings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="wrapper">
    <div id="loginModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="closeModal('loginModal')">&times;</span>
          <h2>Login</h2>
          <form id="loginForm" onsubmit="handleLogin(event)">
              <label for="login-email">Email:</label>
              <input type="email" id="login-email" name="email" required>
              <label for="login-password">Password:</label>
              <input type="password" id="login-password" name="password" required>
              <button type="submit">Login</button>
          </form>
      </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="closeModal('registerModal')">&times;</span>
          <h2>Register</h2>
          <form id="registerForm" onsubmit="handleRegister(event)">
              <label for="reg-email">Email:</label>
              <input type="email" id="reg-email" name="email" required>
              <label for="reg-password">Password:</label>
              <input type="password" id="reg-password" name="password" required>
              <button type="submit">Register</button>
          </form>
      </div>
  </div>
      <header class="header">
          <div class="container">
            <div class="header__inner">
              <a href="index.html" class="logo">
                <img src="images/logo.svg" alt="" class="logo__img">
              </a>
              <nav class="menu">
                <ul class="menu__list">
                    <li class="menu__list-item"><a href="new-cars.html" class="menu__list-link" onclick="fetchCars('Sedan')">NEW CARS</a></li>
                    <li class="menu__list-item"><a href="contacts.html" class="menu__list-link">CONTACT US</a></li>
                    <li class="menu__list-item"><a href="favorites.html" class="menu__list-link">FAVORITES</a></li>
                    <li class="menu__list-item">
                      <a href="#" class="menu__list-link" onclick="toggleLogin()">
                          <span id="login-btn">Login</span>
                      </a>
                  </li>
                  
                    <li class="menu__list-item"><a href="#" class="menu__list-link" onclick="openModal('registerModal')">REGISTER</a></li>
                </ul>
            </nav>
            </div>
          </div>
      </header>
      <main class="main">
        <section class="choose">
          <div class="container">
            <h2 class="section-title">Choose your car</h2>
            <div class="tabs">
              <div class="tabs__btn">
                <button class="tabs__btn-item " data-button="content-1" onclick="fetchCars('Sedan')">Sedan</button>
                <button class="tabs__btn-item " data-button="content-2" onclick="fetchCars('Electric')">Electric</button>
                <button class="tabs__btn-item " data-button="content-3" onclick="fetchCars('SUV')">SUV</button>
                <button class="tabs__btn-item " data-button="content-4" onclick="fetchCars('Sports')">Sports</button>
              </div>
              <div class="tabs__content">
                <div class="tabs__content-item tabs__content-item--active" id="content-1">
                </div>
                <div class="tabs__content-item" id="content-2">2</div>
                <div class="tabs__content-item" id="content-3">3</div>
                <div class="tabs__content-item" id="content-4">4</div>
              </div>
            </div>
          </div>
        </section>
        <section class="blog">
          <div class="container">
            <div class="blog__items">
              <div class="blog__item">
                <img class="blog__item-img" src="images/blog-1.jpg" alt="">
                <h4 class="blog__item-title">An easier way to buy your next Toyota</h4>
                <a href="#" class="blog__item-link">more</a>
              </div>
              <div class="blog__item">
                <img class="blog__item-img" src="images/blog-2.jpg" alt="">
                <h4 class="blog__item-title">A Guide to Road-Tripping With Pets</h4>
                <a href="#" class="blog__item-link">more</a>
              </div>
            </div>
            <a href="#" class="showmore-link">SHOW MORE</a>
          </div>
        </section>
      </main>
      <footer class="footer">
        <div class="container">
          <nav class="footer__menu">
            <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Products</p></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Used</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">New</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Sell your car</a></li></ul>
            <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Resources</p></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Blog</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">FAQ</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Contact us</a></li></ul>
            <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Work With TrueCar</p></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Dealers</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Partners</a></li>
            </ul>
            <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">About</p></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">About us</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Team</a></li>
            <li class="footer__menu-item"><a href="#" class="footer__menu-link">Careers</a></li></ul>
          </nav>
          <ul class="app">
            <li class="app__item">
              <a href="#" class="app__item-link">
                <img class="app__item-img" src="images/appstore.svg" alt="">
              </a>
            </li>
            <li class="app__item">
              <a href="#" class="app__item-link">
                <img class="app__item-img" src="images/googleplay.svg" alt="">
              </a>
            </li>
          </ul>
          <div class="footer__copy">
            <p class="footer__copy-text">
              For questions about the TrueCar Auto Buying Service please call 1-888-878-3227.
Certified Dealers are contractually obligated by TrueCar to meet certain customer service requirements and complete the TrueCar Dealer Certification Program.
            </p>
            <p class="footer__copy-text">
              TrueCar does not broker, sell, or lease motor vehicles. Unless otherwise noted, all vehicles shown on this website are offered for sale by licensed motor vehicle dealers. All vehicles are subject to prior sale. By accessing this website, you agree to the TrueCar Terms of Service and Privacy Policy.
            </p>
          </div>
          <nav class="copy__nav">
            <ul class="copy__nav-list">
              <li class="copy__nav-item"><a href="#" class="copy__nav-link">Terms of Service</a></li>
              <li class="copy__nav-item"><a href="#" class="copy__nav-link">Privacy Policy</a></li>
              <li class="copy__nav-item"><a href="#" class="copy__nav-link">Do Not Sell My Personal Information</a></li>
            </ul>
          </nav>
        </div>
      </footer>
  </div>

  
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      // Здесь вызываем fetchCars для каждого типа машин
      await fetchCars('Sedan');
    });

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    async function fetchCars(type) {
  try {
    const response = await fetch(`http://127.0.0.1:5000/cars?type=${type}`);
    const cars = await response.json();

    const contentContainer = document.getElementById('content-1');
    contentContainer.innerHTML = ''; // Clear existing content

    cars.forEach(car => {
      const card = createCard(car);
      contentContainer.appendChild(card);
    });
  } catch (error) {
    console.error('Error fetching car data:', error);
  }
}

function createCard(car) {
  const card = document.createElement('div');
  card.classList.add('card');

  const cardImage = document.createElement('img');
  cardImage.classList.add('card__img');
  cardImage.src = car.img_url; // Using image URL from the car data
  cardImage.alt = car.name;

  const cardContent = document.createElement('div');
  cardContent.classList.add('card__content');

  const cardTitle = document.createElement('h4');
  cardTitle.classList.add('card__title');
  cardTitle.textContent = car.name;

  const cardText = document.createElement('p');
  cardText.classList.add('card__text');
  cardText.textContent = `Starting from $${car.cost}`;

  const cardPrice = document.createElement('p');
  cardPrice.classList.add('card__price');
  cardPrice.textContent = `$${car.costPerMonth}/mo`;

  const likeButton = document.createElement('button');
  likeButton.classList.add('like-button');
  likeButton.textContent = '♥';
  likeButton.onclick = () => addToFavorites(car._id.$oid); // Pass _id.$oid to addToFavorites

  cardContent.appendChild(cardTitle);
  cardContent.appendChild(cardText);
  cardContent.appendChild(cardPrice);
  cardContent.appendChild(likeButton);

  const cardLink = document.createElement('a');
  cardLink.classList.add('card__link');
  cardLink.href = '#';

  card.appendChild(cardImage);
  card.appendChild(cardContent);
  card.appendChild(cardLink);

  return card;
}

async function addToFavorites(carId) {
  const email = getCookie('email'); // Получаем email из куки или localStorage
  if (!email) {
    alert('You need to be logged in to like a car.');
    return;
  }

  try {
    const response = await fetch('http://127.0.0.1:5000/add-favorite', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ email, car_id: carId })
    });

    if (response.ok) {
      alert('Car added to favorites');
    } else {
      console.error('Error liking the car:', response.statusText);
    }
  } catch (error) {
    console.error('Error liking the car:', error);
  }
}

  
  </script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  

  <style>
    /* CSS styles for like button */
.like-button {
  display: inline-block;
  background-color: #ffffff;
  color: #ff3b30; /* Red color for the heart icon, adjust as needed */
  border: none;
  padding: 5px 10px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.like-button:hover {
  background-color: #ff3b30; /* Red background on hover */
  color: #ffffff; /* White color for the heart icon on hover */
}
  </style>
</body>
</html>
