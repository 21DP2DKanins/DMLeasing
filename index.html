<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&M Leasing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="wrapper">
        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
                <h2>Login</h2>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" name="email" required>
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" name="password" required>
                    <button type="submit">Login</button>
                </form>
            </div>
        </div>

        <!-- Register Modal -->
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
                <h2>Register</h2>
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" name="email" required>
                    <label for="reg-password">Password:</label>
                    <input type="password" id="reg-password" name="password" required>
                    <button type="submit">Register</button>
                </form>
            </div>
        </div>

        <header class="header header-main">
            <div class="container">
                <div class="header__inner">
                    <a href="index.html" class="logo">
                        <img src="images/logo.svg" alt="" class="logo__img">
                    </a>
                    <nav class="menu">
                        <ul class="menu__list">
                            <li class="menu__list-item"><a href="new-cars.html" class="menu__list-link" onclick="fetchCars('Sedan')">NEW CARS</a></li>
                            <li class="menu__list-item"><a href="contacts.html" class="menu__list-link">CONTACT US</a></li>
                            <li class="menu__list-item"><a href="#" onclick="toggleLogin()"><span id="login-btn">Login</span></a></li>
                            <li class="menu__list-item"><a href="#" onclick="openModal('registerModal')">REGISTER</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>
        <main class="main">
            <section class="top">
                <div class="container">
                    <h1 class="title">Leasing From D&M</h1>
                    <a href="new-cars.html" class="top__link">FIND A CAR</a>
                </div>
            </section>
            <div class="slider">
                <div class="swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" style="background-image: url(images/slide-1.jpg);"></div>
                        <div class="swiper-slide" style="background-image: url(images/slide-2.jpg);"></div>
                        <div class="swiper-slide" style="background-image: url(images/slide-3.jpg);"></div>
                        <div class="swiper-slide" style="background-image: url(images/slide-4.jpg);"></div>
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>
            <section class="why-lease">
                <div class="container">
                    <h2 class="section-title">Why Lease with D&M?</h2>
                    <ul class="why-lease__list">
                        <li class="why-lease__item">
                            <img class="why-lease__item-img" src="images/why-lease-1.svg" alt="">
                            <h3 class="why-lease__item-title">Top Dealers</h3>
                            <p class="why-lease__item-text">TrueCar Certified Dealers compete for your business.</p>
                        </li>
                        <li class="why-lease__item">
                            <img class="why-lease__item-img" src="images/why-lease-2.svg" alt="">
                            <h3 class="why-lease__item-title">Transparent Pricing</h3>
                            <p class="why-lease__item-text">Real pricing on actual cars in inventory.</p>
                        </li>
                        <li class="why-lease__item">
                            <img class="why-lease__item-img" src="images/why-lease-3.svg" alt="">
                            <h3 class="why-lease__item-title">Compare Your Options</h3>
                            <p class="why-lease__item-text">See what others paid for the car you want.</p>
                        </li>
                    </ul>
                </div>
            </section>
        </main>
        <footer class="footer">
          <div class="container">
            <nav class="footer__menu">
              <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Products</p></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Used</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">New</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Sell your car</a></li></ul>
              <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Resources</p></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Blog</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">FAQ</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Contact us</a></li></ul>
              <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">Work With TrueCar</p></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Dealers</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Partners</a></li>
              </ul>
              <ul class="footer__menu-list"><li class="footer__menu-item"><p class="footer__menu-title">About</p></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">About us</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Team</a></li>
              <li class="footer__menu-item"><a href="#" class="footer__menu-link">Careers</a></li></ul>
            </nav>
            <ul class="app">
              <li class="app__item">
                <a href="#" class="app__item-link">
                  <img class="app__item-img" src="images/appstore.svg" alt="">
                </a>
              </li>
              <li class="app__item">
                <a href="#" class="app__item-link">
                  <img class="app__item-img" src="images/googleplay.svg" alt="">
                </a>
              </li>
            </ul>
            <div class="footer__copy">
              <p class="footer__copy-text">
                For questions about the TrueCar Auto Buying Service please call 1-888-878-3227.
  Certified Dealers are contractually obligated by TrueCar to meet certain customer service requirements and complete the TrueCar Dealer Certification Program.
              </p>
              <p class="footer__copy-text">
                TrueCar does not broker, sell, or lease motor vehicles. Unless otherwise noted, all vehicles shown on this website are offered for sale by licensed motor vehicle dealers. All vehicles are subject to prior sale. By accessing this website, you agree to the TrueCar Terms of Service and Privacy Policy.
              </p>
            </div>
            <nav class="copy__nav">
              <ul class="copy__nav-list">
                <li class="copy__nav-item"><a href="#" class="copy__nav-link">Terms of Service</a></li>
                <li class="copy__nav-item"><a href="#" class="copy__nav-link">Privacy Policy</a></li>
                <li class="copy__nav-item"><a href="#" class="copy__nav-link">Do Not Sell My Personal Information</a></li>
              </ul>
            </nav>
          </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // Функция для открытия модального окна
        const openModal = (modalId) => {
            document.getElementById(modalId).style.display = 'block';
            // Проверка наличия токена в куках и обновление текста кнопки Login/Logout
            updateLoginButtonText();
        };

        // Функция для закрытия модального окна
        const closeModal = (modalId) => {
            document.getElementById(modalId).style.display = 'none';
        };

        // Функция для обработки логина пользователя
        const handleLogin = async (event) => {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch('http://localhost:5000/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });

                const result = await response.json();
                if (response.ok) {
                    alert(result.message);
                    // Сохранение токена в куках
                    document.cookie = `token=${result.token}; path=/`;
                    // Обновление текста кнопки на Logout и закрытие модального окна
                    updateLoginButtonText();
                    closeModal('loginModal');
                } else {
                    alert(result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        };

        // Функция для обработки регистрации пользователя
        const handleRegister = async (event) => {
            event.preventDefault();
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;

            try {
                const response = await fetch('http://localhost:5000/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });

                const result = await response.json();
                if (response.ok) {
                    // Обработка успешной регистрации: вывод сообщения и закрытие модального окна
                    alert(result.message);
                    closeModal('registerModal');
                } else {
                    // Вывод сообщения об ошибке при регистрации
                    alert(result.message);
                }
            } catch (error) {
                // Вывод сообщения об ошибке в консоль и пользователю
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        };

        // Функция для получения токена из кук
        const getTokenFromCookie = () => {
            const cookies = document.cookie.split('; ');
            for (const cookie of cookies) {
                const [name, value] = cookie.split('=');
                if (name === 'token') {
                    return value;
                }
            }
            return null;
        };

        // Функция для обновления текста кнопки Login/Logout
        const updateLoginButtonText = () => {
            const token = getTokenFromCookie();
            const loginBtn = document.getElementById('login-btn');
            if (token) {
                loginBtn.innerText = 'Logout';
            } else {
                loginBtn.innerText = 'Login';
            }
        };

        // Функция для переключения состояния входа/выхода
        const toggleLogin = () => {
            const token = getTokenFromCookie();
            if (token) {
                handleLogout();
            } else {
                openModal('loginModal');
            }
        };

        // Функция для обработки выхода пользователя
        const handleLogout = () => {
            document.cookie = 'token=; Max-Age=-1; path=/';
            updateLoginButtonText();
        };

        // Функция для получения списка машин
        const fetchCars = async (type) => {
            try {
                const response = await fetch(`http://localhost:5000/cars?type=${type}`);
                const cars = await response.json();
                console.log(cars);
            } catch (error) {
                console.error('Error:', error);
            }
        };

        // Инициализация Swiper для слайдера
        const swiper = new Swiper('.swiper', {
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            autoplay: {
                delay: 2500,
                disableOnInteraction: false,
            },
        });

        // Вызов функции для обновления текста кнопки при загрузке страницы
        window.onload = () => {
            updateLoginButtonText();
        };
    </script>
</body>
</html>
